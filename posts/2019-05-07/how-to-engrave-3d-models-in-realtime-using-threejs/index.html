<!doctype html><html lang="en"><head><meta charset="utf-8"><link rel="shortcut icon" href="/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="rating" content="General"><link rel="alternate" href="https://smddzcy.com/rss.xml" type="application/rss+xml" title="RSS"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="smddzcy.com"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="skype_toolbar" content="skype_toolbar_parser_compatible"><meta name="renderer" content="webkit|ie-comp|ie-stand"><link rel="manifest" href="/manifest.json"><link rel="canonical" href="/posts/2019-05-07/how-to-engrave-3d-models-in-realtime-using-threejs" />

    <title data-react-helmet="true">How to Engrave 3D Models in Real-Time Using Three.js</title>
    
    
  <script>window.__NAVI_STATE__={"__navi__":{"requestDataWithoutState":{}}};</script><link href="/static/css/main.5503d929.chunk.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="BlogLayout_container__3WeFl"><div class="
        LoadingIndicator_LoadingIndicator__22gHk
        
        undefined
      "></div><header><h3 class="BlogLayout_title__6OZKV"><a href="/" context="[object Object]" class=" ">smddzcy | yet another dev</a></h3></header><main><article><header class="BlogPostLayout_header__2LB8S"><h1 class="BlogPostLayout_title__3g2FG"><a href="/posts/2019-05-07/how-to-engrave-3d-models-in-realtime-using-threejs" context="[object Object]" class=" ">How to Engrave 3D Models in Real-Time Using Three.js</a></h1><small><time dateTime="Mon, 06 May 2019 21:00:00 GMT">May 7, 2019</time> <!-- -->•<!-- --> <ul class="ArticleMeta_tags__VKe_V"><li><a href="/tags/javascript" context="[object Object]" class=" ">javascript</a></li><li><a href="/tags/3d" context="[object Object]" class=" ">3d</a></li><li><a href="/tags/three.js" context="[object Object]" class=" ">three.js</a></li></ul> <!-- -->•<!-- --> <span>☕️<!-- --> <!-- -->4<!-- --> min read</span></small></header><div class="BlogPostLayout_content__jzLFq"><div><p>3D modeling is hard, but 3D modeling in Javascript is even <em>harder</em>. Javascript is easy and effective for many problems you need to tackle in your web apps; but when it comes to processing &amp; displaying 3D models, it seems like it doesn’t have the best set of tools.</p><p>Thankfully, there’s a very good API for creating/displaying 3D models, which is <a href="https://threejs.org/" rel="nofollow noopener noreferrer" target="_blank" context="[object Object]" class=" ">three.js</a>. I’m not gonna talk about three.js in general today, but I’m gonna explain how I used three.js to engrave a 3D model with a small hack, but with great success.</p><hr/><p>I’m freelancing for a couple of big fashion firms at the moment. A few weeks ago, I took this project of customizing (i.e. putting custom engravings on) 3D objects on web in real-time. We were already doing 2D engravings, but 3D was a whole new field. At first I didn’t think it was feasible, at least in real-time. But after lots of trials and errors with a 3D designer friend, we found a really good solution.</p><p>We first thought we could dynamically change the texture file and re-apply it on the object to engrave whichever place we want on the object. It sounds like a good and feasible solution, and it might be feasible for some cases, but in our case it was not. The issue is, since the objects we’re going to engrave are complex and not identical (they’re basically built by putting together a bunch of images or a video of the product we got from the studio), texture files are entirely different. To achieve what we wanted, we needed to find the coordinates/angles/etc. of the engraving area for each product, so it wasn’t really feasible.</p><p>Another possible solution was creating a mesh of our engraving dynamically and putting that on the object. But it was really hard to do, again, since the objects were really complex and not identical. We couldn’t possibly find the place to put that mesh dynamically, and even if we did, we could <em>never</em> place it perfectly on those complex surfaces.</p><p>Our clever solution was adding an empty mesh on each 3D model that covers the entire engraving area, and later on replacing that using three.js with the dynamically-created mesh that contains our engraving. This way we didn’t need to know anything about the texture file nor the object file in Javascript.</p><h2 id="object-and-font-preparation">Object and Font Preparation</h2><p>First step is super simple: using any 3D software (e.g. Blender, 3ds Max), just put an empty mesh that covers the whole surface of your engraving area. Later on, we will create a dynamic mesh that contains our engraving using three.js and replace that mesh.</p><img src="/static/media/bag.7e08a934.png" alt="" style="margin-bottom:1.5rem"/><p>An optional step is <em>font preparation</em>. If you’re using images for each letter in your 2D engravings (just like us) because you want to have textures/gradients etc. in your letters, sadly you’ll need to have an actual font file instead of images. You should turn those images into a font using any software or online tool.</p><h2 id="javascript-part">Javascript Part</h2><p>First step is to load the font file in CSS: (if you want to use a custom font)</p><pre><code class="language-css" data-language="css" data-highlighted-line-numbers=""><span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>
      <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"Engraving"</span><span class="token punctuation">;</span>
      <span class="token property">src</span><span class="token punctuation">:</span>  <span class="token url">url("font.otf")</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"opentype"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token url">url("font.ttf")</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"truetype"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token property">text-rendering</span><span class="token punctuation">:</span> optimizeLegibility<span class="token punctuation">;</span>
      <span class="token property">font-feature-settings</span><span class="token punctuation">:</span> <span class="token string">"kern"</span> 1<span class="token punctuation">;</span>
      <span class="token property">font-kerning</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><p>Then create a basic scene in three.js. I’m skipping this since it’s explained in the official docs &amp; many other blogs.</p><p>After creating your scene; create a canvas for the engraving material, and create the engraving material:</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token keyword">const</span> textCanvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#text-canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> engravedText <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Texture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> engravingMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshPhongMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  map<span class="token punctuation">:</span> engravedText<span class="token punctuation">,</span>
  <span class="token comment">// set the material settings so that your engraving will look good</span>
  <span class="token comment">// under different angles/lightings</span>
  color<span class="token punctuation">:</span> <span class="token number">0x969696</span><span class="token punctuation">,</span>
  reflectivity<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  shininess<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  flatShading<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  fog<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  refractionRatio<span class="token punctuation">:</span> <span class="token number">0.98</span><span class="token punctuation">,</span>
  skinning<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  specular<span class="token punctuation">:</span> <span class="token number">0x000000</span><span class="token punctuation">,</span>
  depthFunc<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  blendDst<span class="token punctuation">:</span> <span class="token number">205</span><span class="token punctuation">,</span>
  blendSrc<span class="token punctuation">:</span> <span class="token number">204</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// make it transparent so the only visible thing is the engraving</span>
engravingMaterial<span class="token punctuation">.</span>transparent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre><p>Load your model using three.js and replace the dummy material (which is the engraving area) with the engraving material we just created:</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MTLLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'obj.mtl'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">materials</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          materials<span class="token punctuation">.</span><span class="token function">preload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> manager <span class="token operator">=</span> <span class="token function">initLoadingManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>OBJLoader</span><span class="token punctuation">(</span>manager<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setMaterials</span><span class="token punctuation">(</span>materials<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'obj.obj'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              mainObject <span class="token operator">=</span> object<span class="token punctuation">;</span>
              <span class="token comment">// replace the dummy material with our custom engraving material</span>
              mainObject<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>material <span class="token operator">=</span> engravingMaterial<span class="token punctuation">;</span>
              mainObject<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>material<span class="token punctuation">.</span>needsUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
              <span class="token operator">...</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Now everything is set. There are 3 steps to apply an engraving;</p><ul><li>Fill the <code>textCanvas</code> with your engraving text.</li><li>Apply the canvas to the <code>engravedText</code> texture.</li><li>Apply the <code>engravingMaterial</code> to the main object and re-render.</li></ul><p>Simple enough. Here’s how it looks like in code:</p><pre><code class="language-jsx" data-language="jsx" data-highlighted-line-numbers=""><span class="token keyword">function</span> <span class="token function">engraveText</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> context <span class="token operator">=</span> textCanvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// clear the canvas</span>
  textCanvas<span class="token punctuation">.</span>width <span class="token operator">=</span> textCanvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
  context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>textCanvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span>textCanvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// put the engraving on the canvas</span>
  context<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">"170px Engraving"</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">"#d2c2af"</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span>textAlign <span class="token operator">=</span> <span class="token string">"center"</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span>textBaseline <span class="token operator">=</span> <span class="token string">"middle"</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span><span class="token function">toLocaleUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> textCanvas<span class="token punctuation">.</span>scrollWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> textCanvas<span class="token punctuation">.</span>scrollHeight <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// patch the canvas onto the 3d object</span>
  engravedText<span class="token punctuation">.</span>image <span class="token operator">=</span> textCanvas<span class="token punctuation">;</span>
  engravedText<span class="token punctuation">.</span>needsUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  mainObject<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>material <span class="token operator">=</span> engravingMaterial<span class="token punctuation">;</span>
  mainObject<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>material<span class="token punctuation">.</span>needsUpdate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>Voila. And you should see your text engraved on the object.</p><img src="/static/media/3d-test.d6f4858e.png" alt="" style="margin-bottom:1.5rem"/><p>You can let me know if you have any issues or questions using the comment box below.</p></div></div><div style="margin-top:3rem"><div id="disqus_thread"></div></div><footer class="BlogPostLayout_footer__2aOsZ"><h3 class="BlogPostLayout_title__3g2FG"><a href="/" context="[object Object]" class=" ">smddzcy | yet another dev</a></h3><div class="
      Bio_Bio__3ifbk
      BlogPostLayout_bio__3d60S
    "><img src="https://pbs.twimg.com/profile_images/781276128673689600/tGOdd3qK_400x400.jpg" alt="Me"/><div><div>software engineer, web enthusiast. shares articles, tutorials and his thoughts on various things.</div><div><a href="https://linkedin.com/in/smddzcy" title="LinkedIn" rel="nofollow noopener noreferrer" target="_blank" style="margin-right:5px">LinkedIn</a>•<a href="https://github.com/smddzcy" title="GitHub" rel="nofollow noopener noreferrer" target="_blank" style="margin:0 5px">GitHub</a>•<a href="https://twitter.com/smddzcy" title="Twitter" rel="nofollow noopener noreferrer" target="_blank" style="margin:0 5px">Twitter</a>•<a href="/cv" title="CV" style="margin:0 5px">CV</a></div></div></div><section class="BlogPostLayout_links__2NwEx"><a class="BlogPostLayout_next__3Rs3G " href="/posts/2019-05-06/hello-world" context="[object Object]">Hello Again, World<!-- --> →</a></section></footer></article></main></div></div><script>!function(u){function e(e){for(var t,r,n=e[0],c=e[1],o=e[2],a=0,f=[];a<n.length;a++)r=n[a],l[r]&&f.push(l[r][0]),l[r]=0;for(t in c)Object.prototype.hasOwnProperty.call(c,t)&&(u[t]=c[t]);for(p&&p(e);f.length;)f.shift()();return i.push.apply(i,o||[]),d()}function d(){for(var e,t=0;t<i.length;t++){for(var r=i[t],n=!0,c=1;c<r.length;c++){var o=r[c];0!==l[o]&&(n=!1)}n&&(i.splice(t--,1),e=s(s.s=r[0]))}return e}var r={},f={27:0},l={27:0},i=[];function s(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return u[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.e=function(i){var e=[];f[i]?e.push(f[i]):0!==f[i]&&{1:1,14:1}[i]&&e.push(f[i]=new Promise(function(e,n){for(var t="static/css/"+({}[i]||i)+"."+{1:"dc8a1de5",2:"31d6cfe0",3:"31d6cfe0",4:"31d6cfe0",5:"31d6cfe0",6:"31d6cfe0",7:"31d6cfe0",8:"31d6cfe0",9:"31d6cfe0",10:"31d6cfe0",11:"31d6cfe0",12:"31d6cfe0",13:"31d6cfe0",14:"26efd817",15:"31d6cfe0",16:"31d6cfe0",17:"31d6cfe0",18:"31d6cfe0",19:"31d6cfe0",20:"31d6cfe0",21:"31d6cfe0",22:"31d6cfe0",23:"31d6cfe0",24:"31d6cfe0",25:"31d6cfe0"}[i]+".chunk.css",c=s.p+t,r=document.getElementsByTagName("link"),o=0;o<r.length;o++){var a=(u=r[o]).getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(a===t||a===c))return e()}var f=document.getElementsByTagName("style");for(o=0;o<f.length;o++){var u;if((a=(u=f[o]).getAttribute("data-href"))===t||a===c)return e()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=e,d.onerror=function(e){var t=e&&e.target&&e.target.src||c,r=new Error("Loading CSS chunk "+i+" failed.\n("+t+")");r.request=t,n(r)},d.href=c,document.getElementsByTagName("head")[0].appendChild(d)}).then(function(){f[i]=0}));var r=l[i];if(0!==r)if(r)e.push(r[2]);else{var t=new Promise(function(e,t){r=l[i]=[e,t]});e.push(r[2]=t);var n,c=document.getElementsByTagName("head")[0],o=document.createElement("script");o.charset="utf-8",o.timeout=120,s.nc&&o.setAttribute("nonce",s.nc),o.src=s.p+"static/js/"+({}[i]||i)+"."+{1:"a02ccf8e",2:"6c996c87",3:"9cc1839e",4:"90202c4e",5:"99924aac",6:"27fa9ec8",7:"ebf0ac93",8:"0a122cb7",9:"d55548bd",10:"a2fb5259",11:"f03a1104",12:"087836a7",13:"3ae74583",14:"aa990e45",15:"4eb5e8c7",16:"69b71e54",17:"123149df",18:"7c3ba891",19:"ad4058e7",20:"a877b8ec",21:"02fb6091",22:"8bd11e29",23:"3b72eddf",24:"45b9c2c7",25:"0df70cb4"}[i]+".chunk.js",n=function(e){o.onerror=o.onload=null,clearTimeout(a);var t=l[i];if(0!==t){if(t){var r=e&&("load"===e.type?"missing":e.type),n=e&&e.target&&e.target.src,c=new Error("Loading chunk "+i+" failed.\n("+r+": "+n+")");c.type=r,c.request=n,t[1](c)}l[i]=void 0}};var a=setTimeout(function(){n({type:"timeout",target:o})},12e4);o.onerror=o.onload=n,c.appendChild(o)}return Promise.all(e)},s.m=u,s.c=r,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(r,n,function(e){return t[e]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/",s.oe=function(e){throw console.error(e),e};var t=window.webpackJsonp=window.webpackJsonp||[],n=t.push.bind(t);t.push=e,t=t.slice();for(var c=0;c<t.length;c++)e(t[c]);var p=n;d()}([])</script><script src="/static/js/26.ddbbbcfd.chunk.js"></script><script src="/static/js/main.2da97293.chunk.js"></script></body></html>